<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SceneSync</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- <link href="{{ url_for('static', filename='css/custom-select.css') }}" rel="stylesheet">
    <script src="{{ url_for('static', filename='js/custom-select.js') }}"></script> -->
    <script>
        // Set to false to disable custom selects, true to enable
        window.ENABLE_CUSTOM_SELECT = false;
    </script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</head>
<body>

    <!-- Main Content -->
    <div class="main-container">
        <div class="function-box left-right-box">
            <div class="function-box-left">
                <div class="function-box-header">
                    Configuration
                </div>
                <div class="function-box-content">
                    <form id="matchingForm">
                        <!-- Film Folder Selection -->
                        <div class="mb-3">
                            <label for="filmFolder" class="form-label">Film Photos Folder</label>
                            <select class="form-select" id="filmFolder" required>
                                <option value="">Select a folder...</option>
                            </select>
                        </div>

                        <!-- Scene Folder Selection -->
                        <div class="mb-3">
                            <label for="sceneFolder" class="form-label">Scene Photos Folder</label>
                            <select class="form-select" id="sceneFolder" required>
                                <option value="">Select a folder...</option>
                            </select>
                        </div>

                        <!-- Advanced Options -->
                        <div class="accordion" id="advancedOptions">
                            <div class="accordion-item">
                                <div class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                        Advanced Options
                                    </button>
                                </div>
                                <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#advancedOptions">
                                    <div class="accordion-body">
                                        <div class="mb-3">
                                            <label for="maxFeatures" class="form-label">Max Features</label>
                                            <input type="number" class="form-control" id="maxFeatures" value="800" min="100" max="2000">
                                            <div class="form-text">Maximum number of features to detect (100-2000)</div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="goodMatchPercent" class="form-label">Good Match Percent</label>
                                            <input type="number" class="form-control" id="goodMatchPercent" value="0.15" step="0.01" min="0.05" max="0.5">
                                            <div class="form-text">Threshold for good matches (0.05-0.5)</div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="referenceTable" class="form-label">Reference Table (Optional)</label>
                                            <select class="form-select" id="referenceTable">
                                                <option value="">No reference table</option>
                                            </select>
                                            <div class="form-text">Select a previous result file to build upon existing confident matches</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="form-button-container">
                            <button type="submit" id="matchButton" class="primary-button" style="width: 100%;">
                                Start Matching
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="function-box-right">
                <div class="function-box-content">
                    <div id="folderInfo">
                        <p class="text-muted">Select folders to see information</p>
                    </div>
                    
                    <!-- Film Photos Preview -->
                    <div id="filmPhotosPreview" class="mt-3" style="display: none;">
                        <h6 id="filmFolderTitle">Film Photos Preview</h6>
                        <div id="filmPhotosGrid" class="photos-grid"></div>
                    </div>
                    
                    <!-- Scene Photos Preview -->
                    <div id="scenePhotosPreview" class="mt-3" style="display: none;">
                        <h6 id="sceneFolderTitle">Scene Photos Preview</h6>
                        <div id="scenePhotosGrid" class="photos-grid"></div>
                    </div>
                </div>
            </div>

        </div>
        <div class="function-box">
            <div class="function-box-header">
                Results
                <div class="header-button-container">
                    <button id="downloadBtn" class="secondary-button">
                        Download CSV
                    </button>
                    <button id="verifyBtn" class="secondary-button">
                        Verify Results
                    </button>
                    <button id="inspectBtn" class="secondary-button">
                        Inspect Images
                    </button>
                </div>
            </div>
            <div class="function-box-content">
                <div id="loading" class="loading text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Processing photos...</p>
                </div>
                <div id="resultsContent">
                    <div class="text-center text-muted py-4">
                        <p>Select folders and click "Start Matching" to begin</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="function-box">
            <div class="function-box-header">
                Matching Overview
                <div class="header-button-container">
                    <div class="form-check form-switch" id="toggleVisualizationsContainer">
                        <input class="form-check-input" type="checkbox" id="toggleVisualizations">
                        <!-- <label class="form-check-label" for="toggleVisualizations">Show</label> -->
                    </div>
                </div>
            </div>
            <div class="function-box-content" id="visualizationsSection" style="display: none;">
                <div class="row">
                    <div class="col-md-6">
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="matchStatusChart"></canvas>
                                </div>
                            </div>
                    </div>
                    <div class="col-md-6">
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="confidenceChart"></canvas>
                                </div>
                            </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="function-box">
            <div class="function-box-header">
                Verification
            </div>
            <div class="function-box-content" id="verificationContent" style="display: none;">
                <!-- Verification Results -->
                <div id="verificationMetrics"></div>
                <div id="verificationCharts" class="mt-3">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="chart-container">
                                <canvas id="metricsChart"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="chart-container">
                                <canvas id="detailedMetricsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>

        <div class="function-box left-right-box" id="inspectionSection" style="display: none;">
            <div class="function-box-left">
                <div class="function-box-header">
                    Image Inspection
                </div>
                <div class="function-box-content" style="display: flex; flex-direction: column; gap: 1rem;">
                    <div class="input-container">
                        <label for="inspectFilmPhoto" class="form-label">Film Photo</label>
                        <select class="form-select" id="inspectFilmPhoto" required>
                            <option value="">Select a film photo...</option>
                        </select>
                    </div>
                    <div class="input-container">
                        <label for="inspectScenePhoto" class="form-label">Scene Photo</label>
                        <select class="form-select" id="inspectScenePhoto" required>
                            <option value="">Select a scene photo...</option>
                        </select>
                    </div>
                    <div class="input-container">
                        <label for="inspectMaxFeatures" class="form-label">Max Features</label>
                        <input type="number" class="form-control" id="inspectMaxFeatures" value="800" min="100" max="2000">
                    </div>
                    <div class="input-container">
                        <label for="inspectGoodMatchPercent" class="form-label">Good Match Percent</label>
                        <input type="number" class="form-control" id="inspectGoodMatchPercent" value="0.15" step="0.01" min="0.05" max="0.5">
                    </div>
                    <div class="form-button-container">
                        <button type="button" class="primary-button" id="inspectButton" style="width: 100%;">
                            Inspect Images
                        </button>
                    </div>
                </div>
            </div>
            <div class="function-box-right">
                <div class="function-box-header" style="justify-content: flex-end; border: none;">
                    <button id="downloadVisualBtn" class="secondary-button">Download Visualization</button>
                </div>
                <div class="function-box-content">
                    <div id="inspectionResults" style="display: none; justify-content: center;">
                        <div class="image-container">
                            <img id="visualizationImg" style="max-width: 100%;" />
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>
    
    <!-- Verification Modal -->
    <div class="modal" id="verifyModal" tabindex="-1" aria-labelledby="verifyModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <div class="modal-title" id="verifyModalLabel">Verify Results</div>
            <button type="button" class="icon-button" data-bs-dismiss="modal" aria-label="Close">
                <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="truthFileSelect" class="form-label">Select a truth file:</label>
              <select class="form-select" id="truthFileSelect"></select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="secondary-button" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="primary-button" id="confirmVerifyBtn">Verify</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 